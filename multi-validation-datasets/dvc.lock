schema: '2.0'
stages:
  basic:
    cmd: ./echo.sh
    params:
      params.yaml:
        file: params-default.yaml
      params-default.yaml:
        epochs: 1000
        size: 20000
      params-test.yaml:
        epochs: 1
        size: 5
  train:
    cmd: python stages/train.py
    deps:
    - path: stages/train.py
      md5: 4bf4ade6bd2f8af7a094ee75ebb6a0fd
      size: 244
    params:
      params.yaml:
        train:
          epochs: 5
  data_load:
    cmd: python stages/data_load.py
    deps:
    - path: stages/data_load.py
      md5: 4be7b2175f5d984dfd72946e0235ca5b
      size: 427
    params:
      params.yaml:
        data_load:
          dataset: micro
          sampling:
            enable: true
            size: 5
  data_load_with_preset:
    cmd: python stages/data_load_with_preset.py
    deps:
    - path: stages/data_load_with_preset.py
      md5: 3830fea2052aeccd7adac0da3ba2f361
      size: 377
    params:
      params.yaml:
        data_load:
          dataset: micro
          sampling:
            enable: true
            size: 5
        run_mode: prod
  evaluate@micro:
    cmd: python stages/evaluate.py --config=params.yaml --dataset=micro
    deps:
    - path: stages/evaluate.py
      md5: 84b6a414e3ade688b5efbbb707ab0571
      size: 1107
    params:
      params.yaml:
        evaluate:
          datasets:
          - micro
          - customer-1
          - customer-2
          size: 5000
          metrics:
          - f1
          - roc-auc
          metrics_dir: metrics
          plots_cm: reports/plot_confusion_matrix.png
        reports_dir: reports
    outs:
    - path: reports/metrics/metrics_micro.json
      md5: df72f7285a63c8abd7d92841fea4ec75
      size: 57
  evaluate@customer-1:
    cmd: python stages/evaluate.py --config=params.yaml --dataset=customer-1
    deps:
    - path: stages/evaluate.py
      md5: 84b6a414e3ade688b5efbbb707ab0571
      size: 1107
    params:
      params.yaml:
        evaluate:
          datasets:
          - micro
          - customer-1
          - customer-2
          size: 5000
          metrics:
          - f1
          - roc-auc
          metrics_dir: metrics
          plots_cm: reports/plot_confusion_matrix.png
        reports_dir: reports
    outs:
    - path: reports/metrics/metrics_customer-1.json
      md5: e7aefe9ba13cb8068e4c1297652b4c52
      size: 58
  evaluate@customer-2:
    cmd: python stages/evaluate.py --config=params.yaml --dataset=customer-2
    deps:
    - path: stages/evaluate.py
      md5: 84b6a414e3ade688b5efbbb707ab0571
      size: 1107
    params:
      params.yaml:
        evaluate:
          datasets:
          - micro
          - customer-1
          - customer-2
          size: 5000
          metrics:
          - f1
          - roc-auc
          metrics_dir: metrics
          plots_cm: reports/plot_confusion_matrix.png
        reports_dir: reports
    outs:
    - path: reports/metrics/metrics_customer-2.json
      md5: 0493807e6cc140d3842b3c59f0babfe3
      size: 57
  collect_metrics:
    cmd: python stages/collect_metrics.py --config=params.yaml
    deps:
    - path: reports/metrics
      md5: a1192ca6dc65a7dc95b27391dd8be9e0.dir
      size: 172
      nfiles: 3
    - path: stages/collect_metrics.py
      md5: 694636e8292d81384c1c866d02eca62b
      size: 938
    params:
      params.yaml:
        collect_metrics:
          metrics: metrics.json
        reports_dir: reports
    outs:
    - path: reports/metrics.json
      md5: 874fa3f450e47519961d294a801d6dde
      size: 295
  check_metrics:
    cmd: python stages/check_metrics.py --config=params.yaml
    deps:
    - path: reports/metrics.json
      md5: 874fa3f450e47519961d294a801d6dde
      size: 295
    - path: stages/check_metrics.py
      md5: 208c5d1aed79f4111686e254c533153d
      size: 3279
    params:
      params.yaml:
        check_metrics:
          rules:
            f1:
              low: 0.5
              high: 1.0
            roc-auc:
              low: 0.4
          report: alerts.png
        reports_dir: reports
    outs:
    - path: reports/alerts.png
      md5: b593d3b29e41638214e9d6c2aec4fd7a
      size: 34826
